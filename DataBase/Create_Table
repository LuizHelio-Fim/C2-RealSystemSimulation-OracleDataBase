DROP TABLE AVALIACAO_ALUNO CASCADE CONSTRAINTS;
DROP TABLE GRADE_ALUNO CASCADE CONSTRAINTS;
DROP TABLE AVALIACAO CASCADE CONSTRAINTS;
DROP TABLE OFERTA CASCADE CONSTRAINTS;
DROP TABLE ALUNO CASCADE CONSTRAINTS;
DROP TABLE MATERIA CASCADE CONSTRAINTS;
DROP TABLE PROFESSOR CASCADE CONSTRAINTS;
DROP TABLE CURSO CASCADE CONSTRAINTS;

CREATE TABLE CURSO (
    ID NUMBER(10) PRIMARY KEY NOT NULL 
        GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOME VARCHAR2(100) UNIQUE NOT NULL,
    CARGA_HORARIA_TOTAL NUMBER(5) NOT NULL
);




CREATE TABLE PROFESSOR (
    ID_PROFESSOR NUMBER(10) PRIMARY KEY NOT NULL 
        GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CPF VARCHAR2(14) UNIQUE NOT NULL,
    NOME VARCHAR2(100) NOT NULL,
    DATA_NASC DATE NOT NULL,
    TELEFONE VARCHAR2(15),
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    STATUS VARCHAR2(50) NOT NULL
);



CREATE TABLE MATERIA (
    ID_MATERIA NUMBER(10) NOT NULL,
    ID_CURSO NUMBER(10) NOT NULL,
    PERIODO NUMBER(2) NOT NULL,
    NOME VARCHAR2(100) NOT NULL,
    CARGA_HORARIA NUMBER(4) NOT NULL,
    MEDIA_APROVACAO NUMBER(4, 2) NOT NULL,

    PRIMARY KEY (ID_MATERIA, ID_CURSO),
    FOREIGN KEY (ID_CURSO) REFERENCES CURSO(ID),
    UNIQUE (ID_CURSO, NOME)
);




CREATE TABLE ALUNO (
    MATRICULA NUMBER(10) PRIMARY KEY NOT NULL,
    CPF VARCHAR2(14) UNIQUE NOT NULL,
    NOME VARCHAR2(100) NOT NULL,
    DATA_NASC DATE NOT NULL,
    TELEFONE VARCHAR2(15) NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE NOT NULL,
    PERIODO NUMBER(2) NOT NULL,
    ID_CURSO NUMBER(10) NOT NULL,
    STATUS_CURSO VARCHAR2(50) NOT NULL,

    FOREIGN KEY (ID_CURSO) REFERENCES CURSO(ID)
);




CREATE TABLE OFERTA (
    ID NUMBER(10) PRIMARY KEY NOT NULL 
        GENERATED BY DEFAULT ON NULL AS IDENTITY,
    ANO NUMBER(4) NOT NULL,
    SEMESTRE NUMBER(1) NOT NULL,
    ID_MATERIA NUMBER(10) NOT NULL,
    ID_CURSO NUMBER(10) NOT NULL,
    ID_PROFESSOR NUMBER(10) NOT NULL,

    FOREIGN KEY (ID_PROFESSOR) REFERENCES PROFESSOR(ID_PROFESSOR),
    FOREIGN KEY (ID_MATERIA, ID_CURSO) REFERENCES MATERIA(ID_MATERIA, ID_CURSO),
    UNIQUE (ID_MATERIA, ID_CURSO, ID_PROFESSOR, ANO, SEMESTRE)
);




CREATE TABLE AVALIACAO (
    ID NUMBER(10) PRIMARY KEY NOT NULL 
        GENERATED BY DEFAULT ON NULL AS IDENTITY,
    TIPO VARCHAR2(50) NOT NULL,
    PESO NUMBER(4, 2) NOT NULL,
    DATA DATE NOT NULL,
    ID_OFERTA NUMBER(10) NOT NULL,

    FOREIGN KEY (ID_OFERTA) REFERENCES OFERTA(ID)
);



CREATE TABLE GRADE_ALUNO (
    ID_ALUNO NUMBER(10) NOT NULL,
    ID_OFERTA NUMBER(10) NOT NULL,
    STATUS VARCHAR2(50) NOT NULL,
    MEDIA_FINAL NUMBER(4, 2) NULL,

    PRIMARY KEY (ID_ALUNO, ID_OFERTA),
    FOREIGN KEY (ID_ALUNO) REFERENCES ALUNO(MATRICULA),
    FOREIGN KEY (ID_OFERTA) REFERENCES OFERTA(ID)
);




CREATE TABLE AVALIACAO_ALUNO (
    ID_AVALIACAO NUMBER(10) NOT NULL,
    ID_ALUNO NUMBER(10) NOT NULL,
    NOTA NUMBER(4, 2) NOT NULL,

    PRIMARY KEY (ID_AVALIACAO, ID_ALUNO),
    FOREIGN KEY (ID_AVALIACAO) REFERENCES AVALIACAO(ID),
    FOREIGN KEY (ID_ALUNO) REFERENCES ALUNO(MATRICULA)
);
